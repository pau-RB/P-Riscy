#define SCREEN_WIDTH 160
#define BYTES_PER_PIXEL 1
#define BYTES_PER_ROW (SCREEN_WIDTH * BYTES_PER_PIXEL)
#define SCREEN_MMAP_ADDR 0x2000

#define TO_COLOR(r, g, b) (((r & 0b111) << 5) | ((g & 0b111) << 2) | (b & 0b11))

void setPixel(int x, int y, int color) {
  int offset = BYTES_PER_PIXEL * x + BYTES_PER_ROW * y;
  *(char *)(SCREEN_MMAP_ADDR + offset) = color;
}

#define WIDTH 140
#define HEIGHT 23
#define NUM_COLORS 11
#define CONVERT_RGB(rgb) (TO_COLOR(((rgb >> 16) & 0xFF) * 8 / 256, ((rgb >> 8) & 0xFF) * 8 / 256, (rgb & 0xFF) * 4 / 256))

char color_map[NUM_COLORS][2] = {
  { '.', CONVERT_RGB(0x000000) },
  { '+', CONVERT_RGB(0x242455) },
  { '@', CONVERT_RGB(0xFFB654) },
  { '#', CONVERT_RGB(0x002455) },
  { '$', CONVERT_RGB(0xDB9200) },
  { '%', CONVERT_RGB(0x242400) },
  { '&', CONVERT_RGB(0x492300) },
  { '*', CONVERT_RGB(0x926D00) },
  { '=', CONVERT_RGB(0x6D4900) },
  { '-', CONVERT_RGB(0xB66D00) },
  { ';', CONVERT_RGB(0x494955) },
};

char* risc_v_xpm[] = {
  ".......%=-$$$$$$$$$$$$$%....................................................................................................................",
  "..........*@@@@@@@@@@@@&....................................................................................................................",
  "...........=@@@@@@@@@@@&....................................................................................................................",
  "++++++#.....$@@@@@@@@@@&....................................................................................................................",
  "++++++++#...%@@@@@@@@@@&........#+++++++++++++++++++#....#+++.....++++++++++++++++++++.......#++++++++++++++++........@@@-.............%@@@*",
  "+++++++++....@@@@@@@@@@&........#+++++++++++++++++++++...++++....+++++++++++++++++++++.....+++++++++++++++++++........*@@@%............$@@@.",
  "+++++++++#...$@@@@@@@@$.........#+++++++++++++++++++++#..++++...++++++++++++++++++++++....++++++++++++++++++++.........@@@$...........=@@@=.",
  "++++++++++...$@@@@@@@@&.........#+++...............++++..++++..#+++......................+++++.........................=@@@=..........@@@-..",
  "++++++++++...$@@@@@@@=..........#+++................+++..++++..++++.....................#+++............................-@@@.........-@@@%..",
  "+++++++++....@@@@@@@$...........#+++...............++++..++++..++++.....................+++#............................%@@@-.......%@@@*...",
  "+++++++#....*@@@@@@$............#++++++++++++++++++++++..++++...+++++++++++++++++++.....+++.....................@@@@@@*..*@@@%......$@@$....",
  "++.........%@@@@@@@&............#++++++++++++++++++++#...++++...#+++++++++++++++++++#...+++.....................@@@@@@*...$@@$.....=@@@=....",
  "++........%$@@@@@@*....#........#++++++++++++++++++++....++++....++++++++++++++++++++...+++.....................@@@@@@*...&@@@=....@@@-.....",
  "++.......=@@@@@@@$....+.........#+++..........+++++......++++.....................++++..+++.....................%%%%%%%....-@@@...*@@@%.....",
  "+++....*@@@@@@@@@%...#+.........#+++...........++++......++++.....................++++..+++#...............................%$@@*.%@@@*......",
  "++++....@@@@@@@@=....++.........#+++............#+++.....++++.....................++++..#++++...............................=@@@%$@@$.......",
  "+++++....@@@@@@$....+++.........#+++.............++++....++++..##++++++++++++++++++++....+++++++++++++++++++++...............@@@$@@@&.......",
  "+++++#....$@@@$....++++.........#+++.............+++++...++++..++++++++++++++++++++++.....++++++++++++++++++++...............&@@@@@$........",
  "++++++....%@@@&...#++++.........#+++..............++++...#+++..++++++++++++++++++++#.......+#+++++++++++++++++................-@@@@%........",
  "+++++++....&@*....+++++........................................................................................................&&&%.........",
  "++++++++....=....++++++.....................................................................................................................",
  "+++++++++.......+++++++.....................................................................................................................",
  "+++++++++#......+++++++....................................................................................................................."
};

int getColor(char c) {
  for (int i = 0; i < NUM_COLORS; i++) {
    if (color_map[i][0] == c) {
      return color_map[i][1];
    }
  }
  return -1;
}

int main() {
  /* Paint a picture. */
  for (int x = 0; x < WIDTH; x++) {
    for (int y = 0; y < HEIGHT; y++) {
      setPixel(x, y, getColor(risc_v_xpm[y][x]));
    }
  }
  /* Display it forever. */
  for (volatile int i = 0;; i++);
}
